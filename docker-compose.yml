version: '3.8'

services:
  mcp-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mcp-oauth-server
    environment:
      # OAuth Configuration
      OAUTH_CLIENT_ID: ${OAUTH_CLIENT_ID}
      OAUTH_CLIENT_SECRET: ${OAUTH_CLIENT_SECRET}
      OAUTH_AUTHORIZATION_URL: ${OAUTH_AUTHORIZATION_URL:-https://github.com/login/oauth/authorize}
      OAUTH_TOKEN_URL: ${OAUTH_TOKEN_URL:-https://github.com/login/oauth/access_token}
      OAUTH_SCOPES: ${OAUTH_SCOPES:-read:user}
      
      # API Configuration
      API_BASE_URL: ${API_BASE_URL:-https://api.github.com}
      API_TIMEOUT: ${API_TIMEOUT:-30}
      
      # Server Configuration
      SERVER_NAME: ${SERVER_NAME:-mcp-oauth-server}
      SERVER_VERSION: ${SERVER_VERSION:-0.1.0}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      
      # HTTP Server Configuration
      SERVER_HOST: ${SERVER_HOST:-0.0.0.0}
      SERVER_PORT: ${SERVER_PORT:-8000}
      SERVER_PATH: ${SERVER_PATH:-/mcp}
      OAUTH_REDIRECT_URI: ${OAUTH_REDIRECT_URI:-http://localhost:8000/oauth/callback}
      
      # Development Settings
      ENVIRONMENT: ${ENVIRONMENT:-production}
      DEBUG: ${DEBUG:-false}
    
    # Expose HTTP port
    ports:
      - "8000:8000"
    
    # Restart policy
    restart: unless-stopped
    
    # Resource limits (optional, adjust as needed)
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
    
    # Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
